---
id: task-068
title: Create markdown output formatter
status: todo
assignee: voitb
priority: low
labels:
  - cli
  - output
created: '2026-01-01'
order: 680
---
## Description

Create a markdown formatter for CLI output.

## Acceptance Criteria

- [ ] Create `packages/cli/src/output/markdown.ts`
- [ ] Implement `formatReview()` function
- [ ] Similar structure to terminal formatter
- [ ] Suitable for piping to files or other tools

## Implementation

**File**: `packages/cli/src/output/markdown.ts`

```typescript
import type { ReviewResult, Issue, Severity, Decision } from '@stargazer/core/review/schemas';

const SEVERITY_EMOJI: Record<Severity, string> = {
  critical: 'ðŸ”´',
  high: 'ðŸŸ ',
  medium: 'ðŸŸ¡',
  low: 'ðŸ”µ',
};

const DECISION_TEXT: Record<Decision, string> = {
  approve: 'âœ… Approved',
  request_changes: 'âŒ Changes Requested',
  comment: 'ðŸ’¬ Comment',
};

/**
 * Formats a review result as Markdown.
 * Suitable for saving to files or piping to other tools.
 */
export function formatReview(review: ReviewResult): string {
  const lines: string[] = [];

  // Header
  lines.push('# Code Review Results');
  lines.push('');

  // Decision
  lines.push(`**Decision:** ${DECISION_TEXT[review.decision]}`);
  lines.push('');

  // Summary
  lines.push('## Summary');
  lines.push('');
  lines.push(review.summary);
  lines.push('');

  // Issues
  if (review.issues.length === 0) {
    lines.push('## âœ… No Issues Found');
    lines.push('');
    lines.push('Great job! The code looks good.');
  } else {
    lines.push(`## Issues (${review.issues.length})`);
    lines.push('');

    // Group by severity
    const grouped = groupBySeverity(review.issues);

    for (const severity of ['critical', 'high', 'medium', 'low'] as Severity[]) {
      const issues = grouped[severity];
      if (issues.length > 0) {
        lines.push(`### ${SEVERITY_EMOJI[severity]} ${capitalize(severity)} (${issues.length})`);
        lines.push('');

        for (const issue of issues) {
          lines.push(formatIssue(issue));
          lines.push('');
        }
      }
    }
  }

  // Footer
  lines.push('---');
  lines.push('*Generated by Stargazer AI Reviewer*');

  return lines.join('\n');
}

function formatIssue(issue: Issue): string {
  const lines: string[] = [];

  lines.push(`**\`${issue.file}:${issue.line}\`**`);
  lines.push('');
  lines.push(issue.message);

  if (issue.suggestion) {
    lines.push('');
    lines.push(`> ðŸ’¡ **Suggestion:** ${issue.suggestion}`);
  }

  if (issue.conventionRef) {
    lines.push('');
    lines.push(`> ðŸ“‹ **Convention:** ${issue.conventionRef}`);
  }

  return lines.join('\n');
}

function groupBySeverity(issues: Issue[]): Record<Severity, Issue[]> {
  const grouped: Record<Severity, Issue[]> = {
    critical: [],
    high: [],
    medium: [],
    low: [],
  };

  for (const issue of issues) {
    grouped[issue.severity].push(issue);
  }

  return grouped;
}

function capitalize(str: string): string {
  return str.charAt(0).toUpperCase() + str.slice(1);
}
```

## Test

```bash
cd packages/cli && pnpm tsc --noEmit
```

TypeScript compiles without errors.
